---
title: 计网-传输层
date: 2025-08-05 20:55:16
categories:
    - 408
    - 计网
---

## TCP
TCP建立连接的三次握手过程
| 步骤 | 发送方 | TCP报文关键字段 | 动作与说明 | C的状态 | S的状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **第1次握手** | **C (客户端)** | `SYN=1`, `seq=x` | C随机选择一个初始序列号`x`，将`SYN`标志位置1，发送给S。 | `CLOSED` -> `SYN_SENT` | `LISTEN` |
| **第2次握手** | **S (服务器)** | `SYN=1`, `ACK=1`, `seq=y`, `ack=x+1` | S收到C的请求后，也随机选择一个初始序列号`y`，并将`SYN`和`ACK`标志位都置1。同时，将确认号`ack`设置为`x+1`，表示已收到序列号为`x`的报文。 | `SYN_SENT` | `LISTEN` -> `SYN_RCVD` |
| **第3次握手** | **C (客户端)** | `ACK=1`, `seq=x+1`, `ack=y+1` | C收到S的确认后，发送最后一个确认报文。将`ACK`位置1，`seq`设为`x+1`，`ack`设为`y+1`。S收到后，连接建立。 | `SYN_SENT` -> `ESTABLISHED` | `SYN_RCVD` -> `ESTABLISHED` |

TCP断开连接的四次挥手
| 步骤 | 发送方 | TCP报文关键字段 | 动作与说明 | C的状态 (主动方) | S的状态 (被动方) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **第1次挥手** | **C (客户端)** | `FIN=1`, `seq=u` | C发送一个`FIN`报文，请求关闭从C到S方向的连接。`u`是C之前发送数据的最后一个字节的序列号加1。 | `ESTABLISHED` -> `FIN_WAIT_1` | `ESTABLISHED` |
| **第2次挥手**| **S (服务器)** | `ACK=1`, `ack=u+1` | S收到`FIN`后，发送一个`ACK`报文作为确认。此时S到C方向的连接并未关闭，S仍可发送数据。 | `FIN_WAIT_1` -> `FIN_WAIT_2` | `ESTABLISHED` -> `CLOSE_WAIT` |
| **第3次挥手** | **S (服务器)** | `FIN=1`, `seq=v` | S确认数据已发送完毕后，也发送一个`FIN`报文，请求关闭S到C方向的连接。 | `FIN_WAIT_2` | `CLOSE_WAIT` -> `LAST_ACK` |
| **第4次挥手** | **C (客户端)** | `ACK=1`, `ack=v+1` | C收到S的`FIN`后，发送最后一个`ACK`报文作为确认。 | `FIN_WAIT_2` -> `TIME_WAIT` | `LAST_ACK` -> `CLOSED` |
| **等待** | - | - | C在发送完最后一个`ACK`后，进入`TIME_WAIT`状态，等待**2*MSL**时间后才进入`CLOSED`状态。 | `TIME_WAIT` -> `CLOSED` | `CLOSED` |


[22.39] 假设客户 C 和服务器 S 已建立一个 TCP 连接，通信往返时间 RTT = 50ms，最长报文段寿命 MSL = 800ms，数据传输结束后，C 主动请求断开连接。若从 C 主动向 S 发出 FIN 段时刻算起，则 C 和 S 进入 CLOSED 状态所需的时间至少分别是( )。
A. 850ms, 50ms
B. 1650ms, 50ms
C. 850ms, 75ms
D. 1650ms, 75ms
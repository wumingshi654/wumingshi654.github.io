---
title: 计网-传输层
date: 2025-08-05 20:55:16
categories:
    - 408
    - 计网
---

## TCP

TCP建立连接的三次握手过程

| 步骤 | 发送方 | TCP报文关键字段 | 动作与说明 | C的状态 | S的状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **第1次握手** | **C (客户端)** | `SYN=1`, `seq=x` | C随机选择一个初始序列号`x`，将`SYN`标志位置1，发送给S。 | `CLOSED` -> `SYN_SENT` | `LISTEN` |
| **第2次握手** | **S (服务器)** | `SYN=1`, `ACK=1`, `seq=y`, `ack=x+1` | S收到C的请求后，也随机选择一个初始序列号`y`，并将`SYN`和`ACK`标志位都置1。同时，将确认号`ack`设置为`x+1`，表示已收到序列号为`x`的报文。 | `SYN_SENT` | `LISTEN` -> `SYN_RCVD` |
| **第3次握手** | **C (客户端)** | `ACK=1`, `seq=x+1`, `ack=y+1` | C收到S的确认后，发送最后一个确认报文。将`ACK`位置1，`seq`设为`x+1`，`ack`设为`y+1`。S收到后，连接建立。 | `SYN_SENT` -> `ESTABLISHED` | `SYN_RCVD` -> `ESTABLISHED` |

TCP断开连接的四次挥手

| 步骤 | 发送方 | TCP报文关键字段 | 动作与说明 | C的状态 (主动方) | S的状态 (被动方) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **第1次挥手** | **C (客户端)** | `FIN=1`, `seq=u` | C发送一个`FIN`报文，请求关闭从C到S方向的连接。`u`是C之前发送数据的最后一个字节的序列号加1。 | `ESTABLISHED` -> `FIN_WAIT_1` | `ESTABLISHED` |
| **第2次挥手**| **S (服务器)** | `ACK=1`, `ack=u+1` | S收到`FIN`后，发送一个`ACK`报文作为确认。此时S到C方向的连接并未关闭，S仍可发送数据。 | `FIN_WAIT_1` -> `FIN_WAIT_2` | `ESTABLISHED` -> `CLOSE_WAIT` |
| **第3次挥手** | **S (服务器)** | `FIN=1`, `seq=v` | S确认数据已发送完毕后，也发送一个`FIN`报文，请求关闭S到C方向的连接。 | `FIN_WAIT_2` | `CLOSE_WAIT` -> `LAST_ACK` |
| **第4次挥手** | **C (客户端)** | `ACK=1`, `ack=v+1` | C收到S的`FIN`后，发送最后一个`ACK`报文作为确认。 | `FIN_WAIT_2` -> `TIME_WAIT` | `LAST_ACK` -> `CLOSED` |
| **等待** | - | - | C在发送完最后一个`ACK`后，进入`TIME_WAIT`状态，等待**2*MSL**时间后才进入`CLOSED`状态。 | `TIME_WAIT` -> `CLOSED` | `CLOSED` |


[22.39] 假设客户 C 和服务器 S 已建立一个 TCP 连接，通信往返时间 RTT = 50ms，最长报文段寿命 MSL = 800ms，数据传输结束后，C 主动请求断开连接。若从 C 主动向 S 发出 FIN 段时刻算起，则 C 和 S 进入 CLOSED 状态所需的时间至少分别是( )。
A. 850ms, 50ms
B. 1650ms, 50ms
C. 850ms, 75ms
D. 1650ms, 75ms

服务器 S 断开过程如下：
1.  **t = 0 ms**: 客户端 C 发送 `FIN` 报文给服务器 S。
2.  **t = 25 ms**: 服务器 S 收到 C 的 `FIN`。这需要一个单程的传输时间 (RTT/2)。
3.  **t = 25 ms (立即)**: S 收到 `FIN` 后，立即发送 `ACK` 确认报文给 C。同时，因为题目要求“最少时间”，我们假设 S 没有数据要发送，所以它也**立即**发送自己的 `FIN` 报文给 C。此时 S 进入 `LAST_ACK` 状态，等待 C 的最后确认。
4.  **t = 50 ms**: C 收到 S 的 `FIN` 报文 (从 t=25ms 发出，又经过 25ms 到达)。
5.  **t = 50 ms (立即)**: C 收到 S 的 `FIN` 后，立即发送最后一个 `ACK` 确认报文给 S。
6.  **t = 75 ms**: S 收到 C 发来的最后一个 `ACK` (从 t=50ms 发出，又经过 25ms 到达)。S 收到确认后，立即进入 `CLOSED` 状态。

客户端C的断开过程如下：
1.  **t = 0 ms**: C 发送 `FIN`，进入 `FIN_WAIT_1` 状态。
2.  **t = 25 ms**: C 收到 S 的 `ACK`，进入 `FIN_WAIT_2` 状态。
3.  **t = 50 ms**: C 收到 S 的 `FIN` (如上文分析，S 在 t=25ms 时发出，经过 25ms 到达)。
4.  **t = 50 ms (立即)**: C 收到 S 的 `FIN` 后，发送最后一个 `ACK`，并立即进入 `TIME_WAIT` 状态。
5. 等待**2 * MSL = 1600ms**

所以选D

[22.40] 假设主机 H 通过 HTTP/1.1 请求浏览某 Web 服务器 S 上的 Web 页 news408.html, news408.html 引 用了同目录下的一幅图像，news408.html 文件大小为 1MSS (最大段长)，图像文件大小为 3 MSS, H 访问 S 的往返时间 RTT = 10 ms, 忽略 HTTP 响应报文的首部开销和 TCP 段传输时延。若 H 已 完成域名解析，则从 H 请求与 S 建立 TCP 连接时刻起，到接收到全部内容为止，所需的时间至 少是( )。
A. 30ms
B. 40ms
C. 50ms
D. 60ms

客户端在第三次握手时就可以发送数据了，所以建立连接10ms；发送html文件10ms，客户端收到了 HTML 文件并发送了ACK后根据 TCP 的慢启动机制，服务器在收到这个 ACK 后，会将**拥塞窗口大小翻倍**，即 `cwnd` 从 1 MSS 变为 2 MSS，所以图像需要20ms，共40ms
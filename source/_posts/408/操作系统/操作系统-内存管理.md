---
title: 操作系统-内存管理
date: 2025-07-06 16:55:04
---

## 虚拟内存管理
### 页面置换算法
- 最佳置换
- 先进先出(FIFO)
- 最近最久未使用LRU
- 时钟置换，由于LRU记录时间开销太大，时钟置换将内存中所有页放在一个环形队列，有一个访问位和指针，刚进入时访问位为1，要置换时指针指向的页如果访问位为1，则设为0，指针前移一位直到找到为0的，所以也叫二次机会算法。最坏情况是如果所有页面的访问位都是1，那么指针会完整地扫描一圈，退化为FIFO
- 改进CLOCK，添加了修改位，因为修改过的页面要写回磁盘，开销较大，这时置换优先级为：
    1.  `(0, 0)`: 最近未访问，也未修改。**最佳牺牲品**。
    2.  `(0, 1)`: 最近未访问，但被修改过。次佳选择，淘汰前需要写回磁盘。
    3.  `(1, 0)`: 最近访问过，但未修改。不太适合淘汰。
    4.  `(1, 1)`: 最近访问过，且被修改过。**最不应该淘汰**。

### 抖动与工作集
抖动就是页面频繁换入换出，通常是因为分配值进程的内存太小，导致频繁缺页。

工作集则是一个进程在**某一个时间段 `t` 内**，所需要访问的**页面集合**，被称为该进程在该时间段的工作集，记作 `W(t)`。这个“时间段”通常用一个窗口大小 `Δ` 来衡量，即过去 `Δ` 时间内访问过的页面构成了当前的工作集。
  * **核心意义**：工作集代表了进程在**当前阶段**要高效运行所**必需的内存大小**。如果这些页面都在物理内存中，进程就能顺利执行；如果大量缺失，进程将寸步难行。

由于写回磁盘速度较慢，现代操作系统会采用一种**延迟写（Deferred Write）**策略。它会把这些被“淘汰”的脏页放入一个特殊的页缓冲队列。这个队列有两大作用：

1.  **批量写回**：OS可以将队列中的多个脏页一次性地、在系统不繁忙的时候批量写入磁盘，提高I/O效率。
2.  **快速页面回收（Soft Fault）**：如果在页面被写入磁盘之前，又有进程需要它，OS可以直接从这个队列中将其“拯救”回来，重新分配给进程。这个过程**无需访问磁盘**，速度极快，被称为“软缺页”（Soft Fault）或页面重认（Page Reclaim）。

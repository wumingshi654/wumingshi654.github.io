---
title: 中央处理器
date: 2025-08-02 10:51:51
categories:
    - 408
    - 计算机组成原理
---

## 指令流水线
为了提高处理机的并行性，可以采用

- 时间上的并行技术，将一个任务分解为几个不同的子阶段，使用不同功能部件，这种方法被称为流水线技术
- 空间上的并行技术，在一个处理机内设置多个执行相同任务的功能部件，并让这些功能部件并行工作，这样的处理机被称为超标量处理机。

假设一条指令的执行过程可分为如下 5 个阶段 (也称功能段或流水段)：
* 取指 (IF)：从指令存储器或 Cache 中取指令。
* 译码/读寄存器 (ID)：操作控制器对指令进行译码，同时从寄存器堆中取操作数。
* 执行/计算地址 (EX)：执行运算操作或计算地址。
* 访存 (MEM)：对存储器进行读/写操作。
* 写回 (WB)：将指令执行结果写回寄存器堆。

| 流水段\指令 | IF | ID | EX | MEM | WB |
|:---: |:---:|:---:|:---:|:---:|:---:|
| ALU | 取指 | 译码 读寄存器堆 | 执行 | — | 结果写回寄存器堆 |
| 取/存 | 取指 | 译码 读寄存器堆 | 计算访存有效地址 | 访存 (读/写) | 将读出的数据写入寄存器堆/— |
| 转移 | 取指 | 译码 读寄存器堆 | 计算转移目的地址， 设置条件码 | 若条件成立，将转移 目的地址送 PC | — |

### 流水线冒险

- 结构冒险，操作同一个部件
- 数据冒险，处理后的数据还没写回就读取。数据冒险可以通过转发(旁路)技术解决，EX阶段修改后的数据通过一个数据通路转发给下条指令的EX阶段，这种方法可以解决两个相邻或中间间隔一个指令的运算类指令的数据冒险。但无法解决load-use型，如load+add，这是因为load指令在MEM阶段才直到结果，这时要么阻塞，要么优化指令顺序。
- 控制冒险，如跳转，循环等指令会改变PC值，处理器不知道下一个指令是什么

[23.19] 在采用 “取指、译码/取数、执行、访存、写回” 5 段流水线的 RISC 处理器中，执行如下指令序 列 (第一列为指令序号)，其中 S0、S1、S2、S3 和 t2 表示寄存器编号。若采用转发 (旁路) 技 术处理数据冒险，采用硬件阻塞方式处理控制冒险，则在 I1 \~ I4 执行过程中，发生流水线阻塞 的指令有 ( )。

```
I1   add S2, S1, S0       // R[S2] <- R[S1] + R[S0]
I2   load S3, 0(S2)       // R[S3] <- M[R[S2] + 0]
I3   beq t2, S3, L1       // if R[t2] = R[S3] jump to L1
I4   addi t2, t2, 20      // R[t2] <- R[t2] + 20
I5   L1: ...
```

A. 仅 I3
B. 仅 I2 和 I4
C. 仅 I3 和 I4
D. 仅 I2、I3 和 I4

注意采用转发 (旁路) 技 术处理数据冒险，所以2不会，只有34